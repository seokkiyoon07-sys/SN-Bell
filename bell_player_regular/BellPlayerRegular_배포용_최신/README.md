# 평상시 종소리 프로그램 v1.1 

SN독학기숙학원에서 개발한 평상시 사용을 위한 종소리 자동 재생 프로그램입니다.

## ✨ 주요 특징

- **고정된 스케줄**: 평상시 사용을 위한 20개의 고정된 시간표
- **자동 재생**: 설정된 시간에 자동으로 종소리 재생
- **주말 포함**: 평상시 사용이므로 주말에도 동작
- **간단한 GUI**: 사용자 친화적인 인터페이스
- **수동 재생**: 원하는 종소리를 수동으로 재생 가능

## 🚀 v1.1 새로운 기능

- **🕐 정확한 시간 동기화**: NTP 서버 및 WorldTimeAPI를 통한 정밀한 시간 동기화
- **🛡️ 향상된 안정성**: 구체적인 예외 처리로 안정적인 동작 보장
- **✅ 설정 값 검증**: 잘못된 설정 자동 수정 및 사용자 알림
- **🔒 리소스 누수 방지**: 스마트한 프로세스 관리로 장기 실행 안정성
- **🧪 단위 테스트**: 체계적인 테스트로 코드 품질 보장

## 고정 스케줄

| 시간 | 종류 | 설명 |
|------|------|------|
| 06:00 | 기상종소리 | 아침 기상 알림 |
| 07:20 | 시작종 | 하루 시작 |
| 08:30 | 쉬는시간종 | 첫 번째 휴식 |
| 08:40 | 시작종 | 수업 재개 |
| 10:00 | 쉬는시간종 | 두 번째 휴식 |
| 10:20 | 시작종 | 수업 재개 |
| 12:10 | 식사시간종 | 점심 시간 |
| 13:00 | 시작종 | 오후 수업 시작 |
| 14:20 | 쉬는시간종 | 오후 휴식 |
| 14:40 | 시작종 | 수업 재개 |
| 16:30 | 쉬는시간종 | 오후 휴식 |
| 16:40 | 시작종 | 수업 재개 |
| 17:30 | 식사시간종 | 저녁 식사 |
| 18:30 | 시작종 | 저녁 수업 시작 |
| 19:50 | 쉬는시간종 | 저녁 휴식 |
| 20:00 | 시작종 | 수업 재개 |
| 21:00 | 간식시간종 | 간식 시간 |
| 21:30 | 시작종 | 수업 재개 |
| 22:20 | 학습종료종 | 학습 종료 |
| 22:30 | 하루일과 종료종 | 하루 일과 종료 |

## 🚀 설치 및 실행

### 1. 의존성 설치
```bash
pip install -r requirements.txt
```

### 2. 사운드 파일 준비
- `bell_sound_regular` 폴더에 01.mp3 ~ 20.mp3 파일을 준비
- 다른 확장자(wav, m4a 등)도 지원

### 3. 프로그램 실행
```bash
# GUI 모드로 실행
python gui.py

# 명령행 모드로 실행 (스케줄러만)
python app.py
```

### 4. 테스트 실행 (선택사항)
```bash
# 모든 테스트 실행
python run_tests.py

# 특정 테스트만 실행
python run_tests.py --select
```

## 📖 사용법

### 기본 설정
1. **사운드 폴더**: 종소리 파일이 있는 폴더 경로 설정
2. **볼륨**: 0~1 사이의 값으로 음량 조절 (자동 검증됨)
3. **외부 시간 동기화**: NTP 서버를 통한 정확한 시간 사용
4. **MCI 우선 사용**: Windows 내장 오디오 엔진 사용 (권장)

### 스케줄러 제어
- **스케줄러 시작**: 고정된 시간표에 따라 자동 재생 시작
- **스케줄러 정지**: 자동 재생 중지  
- **테스트 모드**: 모든 종소리를 3초 간격으로 빠르게 재생

### 수동 재생
- 체크박스로 원하는 종소리 선택
- **선택 재생**: 체크된 종소리들을 순차 재생
- **수동 정지**: 재생 중인 종소리 중단
- "선택 재생" 버튼으로 즉시 재생
- "모두 선택", "선택 해제", "디폴트 선택" 기능 제공

## 파일 구조

```
bell_player_regular/
├── app.py              # 메인 로직
├── gui.py              # GUI 인터페이스
├── config.yaml         # 설정 파일
├── requirements.txt    # 의존성 목록
├── README.md          # 사용 설명서
├── logs/              # 로그 파일
└── sounds/            # 종소리 파일 (01.mp3 ~ 20.mp3)
```

## 설정 파일 (config.yaml)

```yaml
timezone: Asia/Seoul          # 시간대
volume: 1.0                   # 볼륨 (0~1)
workdays_only: false          # 주말 포함 여부
allow_weekend: true           # 주말 허용
log_file: logs/bell.log       # 로그 파일 경로
autoplay_next_day: true       # 다음날 자동 재시작
test_mode: false              # 테스트 모드
sound_ext: mp3                # 기본 사운드 확장자
misfire_grace_seconds: 60     # 지연 허용 시간
refresh_time: 00:01           # 새로고침 시간
sounds_dir: C:\code\SN-Bell\bell_sound_regular  # 사운드 폴더
prefer_mci: true              # MCI 우선 사용
ffplay_path: ''               # ffplay 경로 (선택사항)
```

## 🔧 문제 해결

### 오디오 재생 문제
1. **MCI 우선 사용** 체크박스 확인
2. FFmpeg 설치 후 ffplay 경로 설정
3. 사운드 파일 형식 확인 (MP3, WAV 권장)

### 시간 동기화 문제
1. 인터넷 연결 확인
2. 방화벽에서 NTP 포트(123) 허용
3. 로컬 시간으로 자동 폴백됨

### 설정 파일 문제
- 잘못된 설정값은 자동으로 기본값으로 수정됨
- 로그 파일에서 수정된 설정 확인 가능

## 👨‍💻 개발자 가이드

### 프로젝트 구조
```
bell_player_regular/
├── app.py                      # 핵심 비즈니스 로직
├── gui.py                      # GUI 인터페이스
├── config.yaml                 # 설정 파일
├── requirements.txt            # 의존성 목록
├── pytest.ini                 # 테스트 설정
├── run_tests.py               # 테스트 실행 도구
├── CODE_IMPROVEMENTS_2025-10-28.md  # 개선사항 문서
├── tests/                     # 단위 테스트
│   ├── test_config.py        # 설정 검증 테스트
│   ├── test_time_handling.py # 시간 처리 테스트
│   └── test_resource_management.py # 리소스 관리 테스트
└── logs/                      # 로그 파일 저장소
```

### 코드 품질
- **테스트 커버리지**: 핵심 기능 단위 테스트 완료
- **예외 처리**: 구체적인 예외 타입별 처리
- **리소스 관리**: 컨텍스트 매니저 패턴 적용
- **설정 검증**: 자동 검증 및 수정 시스템

### 개발 환경 설정
```bash
# 개발 의존성 포함 설치
pip install -r requirements.txt

# 테스트 실행
python run_tests.py

# 코드 변경 후 테스트 자동 실행
python -m pytest tests/ --watch
```

### 기여 방법
1. 새 기능 개발 시 단위 테스트 작성
2. `validate_config()` 함수에 설정 검증 로직 추가
3. AudioResourceManager 사용하여 리소스 관리
4. 구체적인 예외 처리 구현

### 문서
- **상세 개선사항**: `CODE_IMPROVEMENTS_2025-10-28.md` 참조
- **오류 해결**: `ERROR_SOLUTIONS.md` 참조
- **프로젝트 가이드**: `PROJECT_GUIDE_KO.md` 참조

### 스케줄러 문제
1. 시간대 설정 확인 (Asia/Seoul)
2. 로그 파일 확인 (`logs/bell.log`)
3. 프로그램 재시작

---

## 📊 변경 이력

### v1.1 (2025-10-28)
- ✨ NTP/WorldTimeAPI 시간 동기화 추가
- 🛡️ 구체적인 예외 처리 구현
- ✅ 설정 값 자동 검증 시스템
- 🔒 리소스 누수 방지 시스템
- 🧪 포괄적인 단위 테스트 추가

### v1.0 (이전)
- 기본 종소리 스케줄링 기능
- GUI 인터페이스
- 수동 재생 기능

## ℹ️ 개발자 정보

- **개발**: SN독학기숙학원
- **현재 버전**: v1.1
- **언어**: Python 3.x
- **GUI**: Tkinter
- **테스트**: pytest + unittest
- **최근 개선**: 2025-10-28

## 📄 라이선스

이 프로그램은 SN독학기숙학원에서 개발되었습니다.

---

**🎵 평상시 종소리 프로그램으로 더욱 체계적인 일과 관리를 경험해보세요!**
